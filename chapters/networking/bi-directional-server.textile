---
layout: recipe
title: Bi-Directional Server
chapter: Networking
---

h2. Problem

You want to provide a service over a network that maintains a connection with clients.


h2. Solution

Create a bi-directional TCP server.

h3. Node.js

{% highlight coffeescript %}
net = require 'net'

domain = 'localhost'
port = 9001

server = net.createServer (socket) ->
	console.log "New connection from #{socket.remoteAddress}"

	socket.on 'data', (data) ->
		console.log "#{socket.remoteAddress} sent: #{data}"
		others = server.connections - 1
		socket.write "You have #{others} #{others == 1 and "peer" or "peers"} on this server"
		if /^quit$/.test data
			console.log "Disconnection requested"
			socket.end "Connection ended"

console.log "Listening to #{domain}:#{port}"
server.listen port, domain
{% endhighlight %}

h3. Example Usage

_$ telnet localhost 9001_
Connected to localhost.
Escape character is '^]'.
Hello, World!
Connection closed by foreign host.


h2. Discussion

See also the <a href="/chapters/networking/basic-client.html">Basic Client</a>, the <a href="/chapters/networking/bi-directional-server.html">Bi-Directional Server</a>, and the <a href="/chapters/networking/bi-directional-client.html">Bi-Directional Client recipes</a>.
